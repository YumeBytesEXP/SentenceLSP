<!DOCTYPE html>
<html lang="en">
<head>
	<style>
		:root {
			--primary-bg:#1a1a1a;--secondary-bg:#202020;--accent-bg:#242424;--border-color:#45475a;--text-primary:#cdd6f4;--text-secondary:#6c7086;--accent-pink:#f38ba8;--accent-blue:#89b4fa;--accent-yellow:#f9e2af;--accent-green:#a6e3a1;--accent-purple:#cba6f7;--accent-cyan:#89dceb;--accent-orange:#fab387
		}
		*{box-sizing:border-box}
		html,body{background:linear-gradient(135deg,var(--primary-bg) 0%,var(--secondary-bg) 100%);width:100%;height:100%;margin:0;padding:0;overflow:hidden;font-family:'Cascadia Code','Fira Code','JetBrains Mono',consolas,monospace;color:var(--text-primary)}
		.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--primary-bg);display:flex;align-items:center;justify-content:center;z-index:10000;transition:opacity .2s ease}
		.loading-spinner{width:32px;height:32px;border:2px solid rgba(137,180,250,.3);border-top:2px solid var(--accent-blue);border-radius:50%;animation:spin .8s linear infinite}
		@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
		.editor-container{width:100%;height:100%;display:flex;flex-direction:column;position:relative;opacity:0;transition:opacity .2s ease}
		.editor-container.loaded{opacity:1}
		.toolbar{background:linear-gradient(135deg,#1c1c1c,#252525);backdrop-filter:blur(10px);border-bottom:1px solid rgba(69,71,90,.5);padding:6px 12px;display:flex;align-items:center;justify-content:space-between;height:42px;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.3)}
		.toolbar-section{display:flex;align-items:center;gap:8px}
		
		.toolbar-button{background:linear-gradient(145deg,#2a2a2a,#1f1f1f);border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:6px 10px;color:var(--text-primary);cursor:pointer;transition:all .15s ease;font-size:11px;font-weight:500;display:inline-flex;align-items:center;gap:6px;position:relative;overflow:hidden;letter-spacing:.3px;min-width:auto;height:30px}
		.toolbar-button:hover{background:linear-gradient(145deg,#3a3a3a,#2f2f2f);border-color:rgba(137,180,250,.3);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
		.toolbar-button:active{transform:translateY(0);box-shadow:0 2px 8px rgba(0,0,0,.2)}
		.toolbar-button.active{background:linear-gradient(145deg,var(--accent-blue),#6c91f7);color:#fff;border-color:var(--accent-blue);box-shadow:0 0 12px rgba(137,180,250,.3)}
		.toolbar-button svg{width:14px;height:14px;fill:currentColor;transition:transform .15s ease}
		.toolbar-button:hover svg{transform:scale(1.05)}
		
		.ai-badge{background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border:1px solid #4a4a4a;border-radius:4px;padding:5px 12px;font-size:10px;font-weight:700;letter-spacing:.5px;position:relative;overflow:hidden;cursor:pointer;transition:all .15s ease;display:inline-flex;align-items:center;height:26px;box-shadow:0 2px 8px rgba(0,0,0,.4);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
		.ai-badge span{background:linear-gradient(90deg,#ffffff,#808080,#ffffff,#c0c0c0,#ffffff);background-size:200% 100%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-size:10px;animation:gradientShift 2s ease-in-out infinite}
		@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		.ai-badge:hover{transform:scale(1.02);background:linear-gradient(135deg,#2a2a2a,#3d3d3d);border-color:#6a6a6a}
		
		/* NAPRAWIONY STATUS BAR - zadokowany do dołu */
		.status-bar{
			position:fixed;
			bottom:0;
			left:0;
			right:0;
			background:linear-gradient(135deg,#1f1f1f,#2a2a2a);
			backdrop-filter:blur(10px);
			border-top:1px solid rgba(69,71,90,.5);
			padding:6px 16px;
			display:flex;
			align-items:center;
			justify-content:space-between;
			height:30px;
			font-size:11px;
			color:var(--text-secondary);
			z-index:1001
		}
		.status-item{display:flex;align-items:center;gap:6px}
		.status-indicator{width:8px;height:8px;border-radius:50%;background:var(--accent-green);animation:pulse 2s infinite}
		@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
		.notification{position:fixed;bottom:50px;right:20px;background:linear-gradient(135deg,#2a2a2a,#1f1f1f);backdrop-filter:blur(10px);border:1px solid rgba(69,71,90,.6);border-radius:6px;padding:8px 12px;color:var(--text-primary);font-size:11px;font-weight:500;box-shadow:0 4px 16px rgba(0,0,0,.3);transform:translateX(400px);transition:transform .2s ease;z-index:10001;display:flex;align-items:center;gap:6px;min-width:150px;max-width:280px;height:32px}
		.notification.show{transform:translateX(0)}
		.notification-icon{width:14px;height:14px;fill:var(--accent-green);flex-shrink:0}
		.notification-close{margin-left:auto;cursor:pointer;width:12px;height:12px;fill:var(--text-secondary);transition:fill .15s ease;opacity:.7}
		.notification-close:hover{fill:var(--text-primary);opacity:1}
		.sidebar{position:absolute;left:0;top:42px;bottom:30px;width:280px;background:linear-gradient(145deg,rgba(26,26,26,.95),rgba(45,45,45,.95));backdrop-filter:blur(15px);border-right:1px solid rgba(74,74,74,.5);border-radius:0 12px 12px 0;box-shadow:4px 0 20px rgba(0,0,0,.4);transform:translateX(-100%);transition:transform .25s ease;z-index:999;overflow-y:auto}
		.sidebar.open{transform:translateX(0)}
		.sidebar-section{padding:20px 18px;border-bottom:1px solid rgba(74,74,74,.3);transition:background .15s ease}
		.sidebar-section:hover{background:rgba(255,255,255,.02)}
		.sidebar-section:last-child{border-bottom:none}
		.sidebar-title{color:#c0c0c0;font-weight:600;margin-bottom:16px;font-size:13px;letter-spacing:.5px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
		.sidebar-title::before{content:'';width:3px;height:16px;background:linear-gradient(135deg,#c0c0c0,#808080);border-radius:2px}
		.setting-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding:12px 14px;font-size:12px;color:var(--text-primary);background:linear-gradient(145deg,#2a2a2a,#1f1f1f);border-radius:6px;border:1px solid rgba(74,74,74,.3);transition:all .15s ease;position:relative;overflow:hidden}
		.setting-item:hover{transform:translateX(4px);border-color:rgba(192,192,192,.3);background:linear-gradient(145deg,#3a3a3a,#2f2f2f)}
		.setting-item:last-child{margin-bottom:0}
		.setting-label{font-weight:500;color:#c0c0c0}
		.switch{position:relative;width:44px;height:24px;background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border:2px solid rgba(74,74,74,.4);border-radius:12px;cursor:pointer;transition:all .2s ease;box-shadow:inset 0 2px 4px rgba(0,0,0,.3)}
		.switch:hover{border-color:rgba(192,192,192,.4)}
		.switch.active{background:linear-gradient(135deg,#606060,#404040);border-color:#808080}
		.switch::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;background:linear-gradient(135deg,#c0c0c0,#a0a0a0);border-radius:50%;transition:transform .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.3)}
		.switch.active::after{transform:translateX(20px);background:linear-gradient(135deg,#fff,#e0e0e0)}
		.range-input{width:100px;height:6px;background:linear-gradient(90deg,#2a2a2a,#1a1a1a);border:1px solid rgba(74,74,74,.4);border-radius:3px;outline:none;appearance:none;cursor:pointer;transition:border-color .2s ease}
		.range-input:hover{border-color:rgba(192,192,192,.4)}
		.range-input::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:linear-gradient(135deg,#c0c0c0,#808080);border:2px solid #fff;border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.4);transition:transform .15s ease}
		.range-input::-webkit-slider-thumb:hover{transform:scale(1.1);background:linear-gradient(135deg,#e0e0e0,#a0a0a0)}
		.sidebar::-webkit-scrollbar{width:6px}
		.sidebar::-webkit-scrollbar-track{background:transparent}
		.sidebar::-webkit-scrollbar-thumb{background:linear-gradient(135deg,rgba(192,192,192,.3),rgba(192,192,192,.5));border-radius:3px}
		.sidebar::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,rgba(192,192,192,.5),rgba(192,192,192,.7))}
		
		/* NAPRAWIONY EDITOR WRAPPER - dodany padding-bottom żeby nie był zakryty przez status bar */
		.editor-wrapper{
			flex:1;
			position:relative;
			padding-bottom:30px
		}
		#container{width:100%;height:100%;border-radius:0;box-shadow:inset 0 0 20px rgba(137,180,250,.06),inset 0 0 10px rgba(137,180,250,.03);border:1px solid rgba(137,180,250,.1)}
		.error-message{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#dc2626,#991b1b);color:#fff;padding:20px 30px;border-radius:10px;font-family:monospace;font-size:14px;max-width:80%;text-align:center;z-index:10001;box-shadow:0 10px 40px rgba(0,0,0,.5)}
		@media (max-width:768px){
			.toolbar{padding:4px 8px;height:38px}
			.toolbar-button{padding:5px 8px;font-size:10px;height:28px}
			.toolbar-button svg{width:12px;height:12px}
			.sidebar{width:240px}
			.notification{right:10px;bottom:45px;max-width:calc(100vw - 20px);font-size:10px;height:30px;padding:6px 10px}
			.ai-badge{padding:4px 6px;font-size:9px;height:24px}
		}
		.editor-container,.sidebar{contain:layout style}
		
		/* Preload optimizations */
		.toolbar-button::before{display:none}
		.ai-badge::after{display:none}
	</style>
	<meta charset="utf-8" />
	<title>Sentence LuaU Editor</title>
	<link rel="preconnect" href="https://cdnjs.cloudflare.com">
	<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
</head>
<body>
	<div class="loading-overlay" id="loadingOverlay">
		<div class="loading-spinner"></div>
	</div>
	<div class="editor-container" id="editorContainer">
		<div class="toolbar">
			<div class="toolbar-section">
				<div class="toolbar-button" onclick="toggleSidebar()" title="Settings">
					<svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
				</div>
				<div class="toolbar-button" onclick="toggleMinimap()" title="Minimap">
					<svg viewBox="0 0 24 24"><path d="M15,7V3H9V7H3V9H21V7H15Z M21,11H3V21H21V11Z M9,19V13H15V19H9Z"/></svg>
				</div>
			</div>
			<div class="toolbar-section">
				<div class="ai-badge" title="This editor has been enhanced with AI, thanks to which it includes many improvements, extensions, and optimizations."><span>AI-Enhanced Editor</span></div>
			</div>
		</div>
		<div class="sidebar" id="sidebar">
			<div class="sidebar-section">
				<div class="sidebar-title">Editor Settings</div>
				<div class="setting-item">
					<span class="setting-label">Word Wrap</span>
					<div class="switch" onclick="toggleWordWrap(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Line Numbers</span>
					<div class="switch active" onclick="toggleLineNumbers(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Auto Save</span>
					<div class="switch active" onclick="toggleAutoSave(this)"></div>
				</div>
			</div>
			<div class="sidebar-section">
				<div class="sidebar-title">Appearance</div>
				<div class="setting-item">
					<span class="setting-label">Font Size</span>
					<input type="range" class="range-input" min="10" max="24" value="12" onchange="changeFontSize(this.value)">
				</div>
				<div class="setting-item">
					<span class="setting-label">Line Height</span>
					<input type="range" class="range-input" min="1" max="3" step="0.1" value="1.5" onchange="changeLineHeight(this.value)">
				</div>
			</div>
			<div class="sidebar-section">
				<div class="sidebar-title">LuaU Features</div>
				<div class="setting-item">
					<span class="setting-label">Auto Completion</span>
					<div class="switch active" onclick="toggleAutoCompletion(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Error Detection</span>
					<div class="switch active" onclick="toggleErrorDetection(this)"></div>
				</div>
			</div>
		</div>
		<div class="notification" id="customNotification">
			<svg class="notification-icon" viewBox="0 0 24 24">
				<path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
			</svg>
			<span id="notificationText"></span>
			<svg class="notification-close" viewBox="0 0 24 24" onclick="hideNotification()">
				<path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
			</svg>
		</div>
		<div class="editor-wrapper">
			<div id="container"></div>
		</div>
	</div>
	
	<!-- STATUS BAR PRZENIESIONY NA KONIEC - teraz jest zadokowany -->
	<div class="status-bar">
		<div class="status-item">
			<div class="status-indicator"></div>
			<span id="statusText">Initializing...</span>
		</div>
		<div style="display: flex; gap: 16px;">
			<div class="status-item">
				<span>Line: <span id="currentLine">1</span></span>
			</div>
			<div class="status-item">
				<span>Col: <span id="currentCol">1</span></span>
			</div>
			<div class="status-item">
				<span>LuaU</span>
			</div>
		</div>
	</div>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.41.0/min/vs/loader.min.js"></script>
	<script>
		let editor,editorLoaded=false,statusTimeout,notificationTimeout,autoCompletionEnabled=true;
		const els={};
		
		// Fast element caching with requestAnimationFrame
		function cacheElements(){
			requestAnimationFrame(()=>{
				els.sidebar=document.getElementById('sidebar');
				els.statusText=document.getElementById('statusText');
				els.currentLine=document.getElementById('currentLine');
				els.currentCol=document.getElementById('currentCol');
				els.loadingOverlay=document.getElementById('loadingOverlay');
				els.editorContainer=document.getElementById('editorContainer');
				els.customNotification=document.getElementById('customNotification');
				els.notificationText=document.getElementById('notificationText');
			});
		}
		
		function showError(msg){
			const errorDiv=document.createElement('div');
			errorDiv.className='error-message';
			errorDiv.innerHTML=`<h3>Loading Error</h3><p>${msg}</p>`;
			document.body.appendChild(errorDiv);
			if(els.loadingOverlay)els.loadingOverlay.style.display='none';
		}
		
		function showNotification(msg,duration=2500){
			if(!els.customNotification||!els.notificationText)return;
			els.notificationText.textContent=msg;
			els.customNotification.classList.add('show');
			clearTimeout(notificationTimeout);
			notificationTimeout=setTimeout(()=>hideNotification(),duration);
		}
		
		function hideNotification(){
			if(els.customNotification)els.customNotification.classList.remove('show');
		}
		
		function updateStatus(text,duration=1500){
			if(!els.statusText)return;
			els.statusText.textContent=text;
			clearTimeout(statusTimeout);
			statusTimeout=setTimeout(()=>{
				if(els.statusText&&editorLoaded)els.statusText.textContent='Ready';
			},duration);
		}
		
		function hideLoadingOverlay(){
			if(els.loadingOverlay){
				els.loadingOverlay.style.opacity='0';
				setTimeout(()=>{
					els.loadingOverlay.style.display='none';
					els.editorContainer.classList.add('loaded');
				},200);
			}
		}
		
		// Optimized LuaU suggestions - reduced set for faster loading
		function createLuauSuggestions(){
			return [
				{label:'game',kind:monaco.languages.CompletionItemKind.Variable,documentation:'Root game object'},
				{label:'workspace',kind:monaco.languages.CompletionItemKind.Variable,documentation:'Game workspace'},
				{label:'Players',kind:monaco.languages.CompletionItemKind.Variable,documentation:'Players service'},
				{label:'ReplicatedStorage',kind:monaco.languages.CompletionItemKind.Variable,documentation:'Replicated storage'},
				{label:'RunService',kind:monaco.languages.CompletionItemKind.Variable,documentation:'Run service'},
				{label:'GetService',kind:monaco.languages.CompletionItemKind.Method,insertText:'GetService("${1:ServiceName}")'},
				{label:'FindFirstChild',kind:monaco.languages.CompletionItemKind.Method,insertText:'FindFirstChild("${1:Name}")'},
				{label:'WaitForChild',kind:monaco.languages.CompletionItemKind.Method,insertText:'WaitForChild("${1:Name}")'},
				{label:'Clone',kind:monaco.languages.CompletionItemKind.Method,documentation:'Clone object'},
				{label:'Destroy',kind:monaco.languages.CompletionItemKind.Method,documentation:'Destroy object'},
				{label:'Connect',kind:monaco.languages.CompletionItemKind.Method,insertText:'Connect(${1:function})'},
				{label:'function',kind:monaco.languages.CompletionItemKind.Keyword,insertText:'function ${1:name}(${2:args})\\n\\t${3:-- code}\\nend'},
				{label:'if',kind:monaco.languages.CompletionItemKind.Keyword,insertText:'if ${1:condition} then\\n\\t${2:-- code}\\nend'},
				{label:'for',kind:monaco.languages.CompletionItemKind.Keyword,insertText:'for ${1:i} = ${2:1}, ${3:10} do\\n\\t${4:-- code}\\nend'},
				{label:'while',kind:monaco.languages.CompletionItemKind.Keyword,insertText:'while ${1:condition} do\\n\\t${2:-- code}\\nend'},
				{label:'print',kind:monaco.languages.CompletionItemKind.Function,insertText:'print(${1:value})'},
				{label:'wait',kind:monaco.languages.CompletionItemKind.Function,insertText:'wait(${1:seconds})'},
				{label:'spawn',kind:monaco.languages.CompletionItemKind.Function,insertText:'spawn(${1:function})'},
				{label:'Part',kind:monaco.languages.CompletionItemKind.Class,documentation:'3D part'},
				{label:'Script',kind:monaco.languages.CompletionItemKind.Class,documentation:'Server script'}
			];
		}
		
		function createLuauCompletionProvider(){
			const suggestions=createLuauSuggestions();
			return {
				provideCompletionItems:(model,position)=>{
					if(!autoCompletionEnabled)return{suggestions:[]};
					const word=model.getWordUntilPosition(position);
					const range={
						startLineNumber:position.lineNumber,
						endLineNumber:position.lineNumber,
						startColumn:word.startColumn,
						endColumn:word.endColumn
					};
					return{suggestions:suggestions.map(item=>({...item,range,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet}))};
				},
				triggerCharacters:['.', ':']
			};
		}
		
		// Faster Monaco initialization
		require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.41.0/min/vs'}});
		
		require(['vs/editor/editor.main'],function(){
			try{
				updateStatus('Loading...');
				
				// Lightweight theme
				monaco.editor.defineTheme('FastLuauTheme',{
					base:'vs-dark',
					inherit:true,
					rules:[
						{token:'comment',foreground:'6c7086'},
						{token:'keyword',foreground:'cba6f7'},
						{token:'string',foreground:'a6e3a1'},
						{token:'number',foreground:'fab387'},
						{token:'function',foreground:'f38ba8'}
					],
					colors:{
						'editor.background':'#202020',
						'editor.foreground':'#cdd6f4',
						'editorCursor.foreground':'#f5e0dc',
						'editor.lineHighlightBackground':'#303030',
						'editorLineNumber.foreground':'#6c7086'
					}
				});
				
				monaco.languages.registerCompletionItemProvider('lua',createLuauCompletionProvider());
				
				// Minimal editor config for fast loading
				const editorConfig={
					language:'lua',
					theme:'FastLuauTheme',
					automaticLayout:true,
					minimap:{enabled:false},
					fontSize:12,
					fontFamily:'Cascadia Code,Fira Code,consolas,monospace',
					scrollBeyondLastLine:false,
					renderLineHighlight:'line',
					wordWrap:'off',
					smoothScrolling:false,
					cursorBlinking:'solid',
					suggest:{showKeywords:true,showSnippets:true,localityBonus:true},
					quickSuggestions:{other:true,comments:false,strings:true},
					scrollbar:{useShadows:false}
				};
				
				editor=monaco.editor.create(document.getElementById('container'),editorConfig);
				
				// Throttled cursor position updates
				let lastUpdate=0;
				editor.onDidChangeCursorPosition((e)=>{
					const now=Date.now();
					if(now-lastUpdate>50){ // 20fps max
						if(els.currentLine&&els.currentCol){
							els.currentLine.textContent=e.position.lineNumber;
							els.currentCol.textContent=e.position.column;
						}
						lastUpdate=now;
					}
				});
				
				let changeTimeout;
				editor.onDidChangeModelContent(()=>{
					clearTimeout(changeTimeout);
					changeTimeout=setTimeout(()=>updateStatus('Auto-saved',1000),1000);
				});
				
				// Notify C# that editor is ready
				if(window.chrome && window.chrome.webview){
					window.chrome.webview.postMessage('EDITOR_READY');
				}
				
				editorLoaded=true;
				hideLoadingOverlay();
				updateStatus('Ready');
			}catch(error){
				console.error('Editor error:',error);
				showError(`Failed to load editor: ${error.message}`);
			}
		},function(error){
			console.error('Monaco error:',error);
			showError('Failed to load Monaco Editor. Check your connection.');
		});
		
		// Throttled resize handler
		let resizeTimeout;
		window.addEventListener('resize',function(){
			clearTimeout(resizeTimeout);
			resizeTimeout=setTimeout(()=>{
				if(editorLoaded&&editor)editor.layout();
			},150);
		});
		
		// UI Functions
		window.toggleSidebar=()=>els.sidebar?.classList.toggle('open');
		
		window.toggleMinimap=function(){
			if(!editorLoaded)return;
			const minimapEnabled=editor.getOptions().get(monaco.editor.EditorOption.minimap).enabled;
			editor.updateOptions({minimap:{enabled:!minimapEnabled}});
			const button=document.querySelector('[onclick="toggleMinimap()"]');
			if(button)button.classList.toggle('active');
			showNotification(minimapEnabled?'Minimap disabled':'Minimap enabled');
		}
		
		window.changeFontSize=function(size){
			if(!editorLoaded)return;
			editor.updateOptions({fontSize:parseInt(size)});
			showNotification(`Font size: ${size}px`);
		}
		
		window.changeLineHeight=function(height){
			if(!editorLoaded)return;
			editor.updateOptions({lineHeight:parseFloat(height)});
			showNotification(`Line height: ${height}`);
		}
		
		window.toggleWordWrap=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const wordWrap=element.classList.contains('active');
			editor.updateOptions({wordWrap:wordWrap?'on':'off'});
			showNotification(`Word wrap ${wordWrap?'enabled':'disabled'}`);
		}
		
		window.toggleLineNumbers=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const lineNumbers=element.classList.contains('active');
			editor.updateOptions({lineNumbers:lineNumbers?'on':'off'});
			showNotification(`Line numbers ${lineNumbers?'enabled':'disabled'}`);
		}
		
		window.toggleAutoSave=function(element){
			element.classList.toggle('active');
			const autoSave=element.classList.contains('active');
			showNotification(`Auto-save ${autoSave?'enabled':'disabled'}`);
		}
		
		window.toggleAutoCompletion=function(element){
			element.classList.toggle('active');
			autoCompletionEnabled=element.classList.contains('active');
			showNotification(`Auto completion ${autoCompletionEnabled?'enabled':'disabled'}`);
		}
		
		window.toggleErrorDetection=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const enabled=element.classList.contains('active');
			editor.updateOptions({renderValidationDecorations:enabled?'on':'off'});
			showNotification(`Error detection ${enabled?'enabled':'disabled'}`);
		}
		
		// API Functions for C# integration
		window.GetText=function(){return editorLoaded?editor.getValue():'';}
		window.SetText=function(text){if(editorLoaded)editor.setValue(text||'');}
		window.SetTheme=function(theme){
			if(editorLoaded){
				monaco.editor.setTheme(theme==='Dark'?'FastLuauTheme':'vs');
			}
		}
		window.hideNotification=hideNotification;
		
		// Keyboard shortcuts
		document.addEventListener('keydown',function(e){
			if(e.ctrlKey&&e.key==='s'){
				e.preventDefault();
				showNotification('Auto-save enabled');
			}
			if(e.key==='Escape'){
				if(els.sidebar?.classList.contains('open')){
					toggleSidebar();
				}else if(els.customNotification?.classList.contains('show')){
					hideNotification();
				}
			}
			if(e.ctrlKey&&e.shiftKey&&e.key==='F'){
				e.preventDefault();
				if(editorLoaded){
					editor.getAction('editor.action.formatDocument').run();
					showNotification('Code formatted');
				}
			}
		});
		
		// Initialize
		document.addEventListener('DOMContentLoaded',cacheElements);
	</script>
</body>
</html>